<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makara - Kelime Oyunu v4 (Sesli & KurallÄ±)</title>
    <style>
        :root { --primary: #2ecc71; --secondary: #3498db; --danger: #e74c3c; --dark: #2c3e50; --light: #ecf0f1; --accent: #f1c40f; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--dark); color: var(--light); margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        #game-container { width: 100%; max-width: 600px; height: 100%; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; position: relative; }
        .screen { display: none; flex-direction: column; height: 100%; overflow-y: auto; }
        .active { display: flex; }
        h1 { text-align: center; color: var(--primary); margin: 10px 0; letter-spacing: 2px; }
        .card { background: white; color: var(--dark); border-radius: 15px; padding: 40px 20px; text-align: center; font-size: 2.2rem; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.3); margin: 20px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; border: 4px solid var(--accent); }
        button { padding: 15px; border: none; border-radius: 10px; font-size: 1rem; font-weight: bold; cursor: pointer; margin: 5px; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-main { background: var(--primary); color: white; width: 100%; font-size: 1.2rem; }
        .btn-rules { background: transparent; color: var(--accent); border: 2px solid var(--accent); width: 100%; margin-top: 10px; }
        .btn-pass { background: var(--secondary); color: white; flex: 1; }
        .btn-correct { background: var(--primary); color: white; flex: 2; }
        .setup-group { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--accent); }
        select, input { width: 100%; padding: 10px; border-radius: 5px; border: none; margin-bottom: 10px; box-sizing: border-box; font-size: 1rem; }
        .player-row { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
        .word-item { background: rgba(255,255,255,0.1); padding: 12px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }
        .round-banner { background: var(--accent); color: var(--dark); padding: 8px; text-align: center; font-weight: bold; border-radius: 5px; margin-bottom: 10px; font-size: 1.1rem; }
        .scoreboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; margin-top: auto; }
        .team-score { text-align: center; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1); padding: 5px; border-radius: 5px; }
        .timer { color: var(--danger); font-size: 2rem; font-weight: bold; }
        
        /* Modal (Kurallar) */
        #rules-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .modal-content { background: var(--dark); border: 2px solid var(--primary); padding: 25px; border-radius: 15px; text-align: left; }
        .modal-content h2 { color: var(--primary); margin-top: 0; }
        .modal-content p { line-height: 1.6; font-size: 1.1rem; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="game-container">
    
    <div id="rules-modal">
        <div class="modal-content">
            <h2>Oyun KurallarÄ±</h2>
            <p><strong>1. Tur:</strong> Kelimeyi kafana gÃ¶re anlat, yasak yok!</p>
            <p><strong>2. Tur:</strong> Ã‡Ä±kan kelimeyi sadece tek bir kelimeyle anlat.</p>
            <p><strong>3. Tur:</strong> KonuÅŸmak yok! Kelimeyi sessizce anlat.</p>
            <button class="btn-main" onclick="closeRules()">ANLADIM</button>
        </div>
    </div>

    <div id="screen-setup" class="screen active">
        <h1>MAKARA</h1>
        <div class="setup-group">
            <label>Oyun Kurulumu</label>
            <div style="display: flex; gap: 10px;">
                <select id="select-players-count" onchange="generatePlayerInputs()">
                    <option value="4">4 Oyuncu</option>
                    <option value="6">6 Oyuncu</option>
                    <option value="8">8 Oyuncu</option>
                </select>
                <select id="select-teams-count" onchange="generatePlayerInputs()">
                    <option value="2">2 TakÄ±m</option>
                    <option value="3">3 TakÄ±m</option>
                    <option value="4">4 TakÄ±m</option>
                </select>
                <select id="select-time">
                    <option value="30">30 Saniye</option>
                    <option value="60" selected>60 Saniye</option>
                    <option value="90">90 Saniye</option>
                </select>
            </div>
        </div>
        <div class="setup-group" id="player-inputs" style="max-height: 250px; overflow-y: auto;"></div>
        <button class="btn-main" onclick="initGame()">OYUNU BAÅLAT</button>
        <button class="btn-rules" onclick="openRules()">NASIL OYNANIR? (KURALLAR)</button>
    </div>

    <div id="screen-selection" class="screen">
        <h3 id="player-selection-title">-</h3>
        <p>Ä°stemediÄŸin 3 kelimeyi ele (Hak: <span id="discard-count">3</span>)</p>
        <div id="word-selection-list" style="flex-grow:1; overflow-y:auto;"></div>
        <button id="btn-next-player" class="btn-main" style="display:none;" onclick="nextPlayerSelection()">SIRADAKÄ° OYUNCU</button>
    </div>

    <div id="screen-play" class="screen">
        <div class="round-banner" id="round-instruction">-</div>
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div id="turn-info">AnlatÄ±cÄ±: <span id="current-player-name" style="color:var(--accent)">-</span></div>
            <div class="timer" id="timer-display">60</div>
        </div>

        <div id="ready-zone" style="margin-top:20px;">
            <button class="btn-main" style="height: 150px; font-size: 1.5rem;" onclick="startTurn()">TURU BAÅLAT</button>
        </div>

        <div id="play-zone" class="hidden">
            <div class="card" id="current-word">YÃœKLENÄ°YOR...</div>
            <div style="display:flex;">
                <button class="btn-pass" onclick="handlePass()">PAS</button>
                <button class="btn-correct" onclick="handleCorrect()">BÄ°LDÄ°!</button>
            </div>
        </div>

        <div class="scoreboard" id="scoreboard-ui"></div>
        <p id="deck-info" style="text-align:center; font-size:0.8em; margin-top:10px;"></p>
    </div>

    <div id="screen-result" class="screen">
        <h1>OYUN BÄ°TTÄ°!</h1>
        <div class="card" id="winner-text" style="font-size: 1.2rem; flex-direction: column; min-height: 200px;"></div>
        <button class="btn-main" onclick="location.reload()">YENÄ° OYUN</button>
    </div>
</div>

<script>
    // SES EFEKTLERÄ° (Web Audio API kullanÄ±larak basit sinyal sesleri)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'pass') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'timeup') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }
    }

    // KELÄ°ME HAVUZU
    const wordsBase = ["Telefon", "GÃ¶zlÃ¼k", "Klavye", "KulaklÄ±k", "Åemsiye", "BuzdolabÄ±", "KaktÃ¼s", "Ayna", "CÃ¼zdan", "Anahtar", "Piyano", "Gitar", "Davul", "Keman", "FlÃ¼t", "Mikrofon", "Sahne", "Konser", "AlbÃ¼m", "ÅarkÄ±", "Aslan", "ZÃ¼rafa", "Penguen", "KaplumbaÄŸa", "Kartal", "Ahtapot", "Kelebek", "ArÄ±", "Fil", "Kedi", "Domates", "PatlÄ±can", "Karpuz", "Ã‡ilek", "Ananas", "Ispanak", "Bezelye", "Mantar", "MÄ±sÄ±r", "Zeytin", "Ä°stanbul", "Ankara", "Ä°zmir", "Paris", "Londra", "Roma", "Tokyo", "Berlin", "Moskova", "Madrid", "Futbol", "Basketbol", "Voleybol", "Tenis", "YÃ¼zme", "KoÅŸu", "Kayak", "SatranÃ§", "Boks", "GÃ¼reÅŸ", "Mutluluk", "HÃ¼zÃ¼n", "Korku", "Ã–fke", "ÅaÅŸkÄ±nlÄ±k", "Heyecan", "Cesaret", "SabÄ±r", "SaygÄ±", "Sevgi", "Doktor", "MÃ¼hendis", "Ã–ÄŸretmen", "Avukat", "Pilot", "AÅŸÃ§Ä±", "Bakkal", "Polis", "Ä°tfaiye", "Yazar", "Araba", "Gemi", "UÃ§ak", "Bisiklet", "Motosiklet", "Tren", "OtobÃ¼s", "Kamyon", "Helikopter", "Fayton", "GÃ¼neÅŸ", "Ay", "YÄ±ldÄ±z", "DÃ¼nya", "Mars", "VenÃ¼s", "Galaksi", "Astronot", "Teleskop", "Uydu", "Kitap", "Dergi", "Gazete", "KÃ¼tÃ¼phane", "Roman", "Åiir", "Masal", "Hikaye", "SÃ¶zlÃ¼k", "Defter", "Mavi", "KÄ±rmÄ±zÄ±", "SarÄ±", "YeÅŸil", "Turuncu", "Mor", "Pembe", "Siyah", "Beyaz", "Gri", "Ekmek", "Peynir", "Yumurta", "SÃ¼t", "Kahve", "Ã‡ay", "Ã‡ikolata", "BalÄ±k", "Kebap", "MantÄ±", "Okul", "Hastane", "Park", "Sinema", "Tiyatro", "MÃ¼ze", "Market", "Eczane", "Banka", "Postane", "Yaz", "KÄ±ÅŸ", "Ä°lkbahar", "Sonbahar", "YaÄŸmur", "Kar", "RÃ¼zgar", "ÅimÅŸek", "Bulut", "FÄ±rtÄ±na", "Bilgisayar", "Ä°nternet", "YazÄ±lÄ±m", "Robot", "Kamera", "Televizyon", "Radyo", "Saat", "Lamba", "Pil", "YastÄ±k", "Battaniye", "Yorgan", "HalÄ±", "Perde", "Koltuk", "Masa", "Sandalye", "Dolap", "Ã‡ekmece", "DiÅŸ FÄ±rÃ§asÄ±", "Sabun", "Åampuan", "Havlu", "Tarak", "ParfÃ¼m", "Krem", "Ruj", "Oje", "Ã‡ekiÃ§", "Tornavida", "Pense", "Testere", "Matkap", "Boyalar", "FÄ±rÃ§a", "Tuval", "Heykel", "Sergi", "Bayram", "DÃ¼ÄŸÃ¼n", "DoÄŸum GÃ¼nÃ¼", "Hediye", "Pasta", "Balon", "Havai FiÅŸek", "Tatil", "Yolculuk", "Bilet", "MÄ±knatÄ±s", "Pusula", "DÃ¼rbÃ¼n", "SaksÄ±", "Kravat", "Eldiven", "Ã‡izme", "Limon", "UÃ§urtma", "Deniz YÄ±ldÄ±zÄ±", "Kum Saati", "MeÅŸale", "ParaÅŸÃ¼t"];

    let config = { players: [], teams: 2, time: 60, currentRound: 1 };
    let masterDeck = [];
    let playDeck = [];
    let scores = {};
    let currentPlayerIdx = 0;
    let timerObj;
    let tempPlayerWords = [];
    let selectionPlayerIdx = 0;
    let discardsLeft = 3;

    function openRules() { document.getElementById('rules-modal').style.display = 'flex'; }
    function closeRules() { document.getElementById('rules-modal').style.display = 'none'; }

    function generatePlayerInputs() {
        const pCount = document.getElementById('select-players-count').value;
        const tCount = document.getElementById('select-teams-count').value;
        const container = document.getElementById('player-inputs');
        container.innerHTML = '<label>Oyuncu Ä°simleri ve TakÄ±mlarÄ±</label>';
        for(let i=1; i<=pCount; i++) {
            let teamOptions = "";
            for(let t=1; t<=tCount; t++) {
                let selected = (i % tCount == t % tCount) ? "selected" : "";
                teamOptions += `<option value="${t}" ${selected}>${t}. TakÄ±m</option>`;
            }
            container.innerHTML += `
                <div class="player-row">
                    <input type="text" id="p-name-${i}" value="Oyuncu ${i}">
                    <select id="p-team-${i}" style="width:120px;">${teamOptions}</select>
                </div>`;
        }
    }
    generatePlayerInputs();

    function initGame() {
        audioCtx.resume(); // Ses motorunu aktif et
        const pCount = parseInt(document.getElementById('select-players-count').value);
        config.teams = parseInt(document.getElementById('select-teams-count').value);
        config.time = parseInt(document.getElementById('select-time').value);
        config.players = [];
        for(let i=1; i<=pCount; i++) {
            config.players.push({
                name: document.getElementById(`p-name-${i}`).value,
                team: parseInt(document.getElementById(`p-team-${i}`).value)
            });
        }
        for(let i=1; i<=config.teams; i++) scores[i] = 0;
        const shuffled = [...wordsBase].sort(() => 0.5 - Math.random());
        tempPlayerWords = [];
        for(let i=0; i<pCount; i++) { tempPlayerWords.push(shuffled.slice(i*10, (i+1)*10)); }
        showScreen('screen-selection');
        startSelectionPhase();
    }

    function startSelectionPhase() {
        discardsLeft = 3;
        const listDiv = document.getElementById('word-selection-list');
        const nextBtn = document.getElementById('btn-next-player');
        document.getElementById('player-selection-title').innerText = config.players[selectionPlayerIdx].name + " seÃ§im yapÄ±yor...";
        document.getElementById('discard-count').innerText = discardsLeft;
        nextBtn.style.display = 'none';
        listDiv.innerHTML = '';
        tempPlayerWords[selectionPlayerIdx].forEach((word, idx) => {
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerHTML = `<span>${word}</span><button onclick="discardWord(${idx}, this)" style="background:var(--danger); color:white; padding:5px 12px; border-radius:5px;">ELE</button>`;
            listDiv.appendChild(div);
        });
    }

    function discardWord(idx, btn) {
        if(discardsLeft > 0) {
            tempPlayerWords[selectionPlayerIdx][idx] = null;
            discardsLeft--;
            playSound('pass');
            btn.parentElement.style.opacity = "0.2";
            btn.parentElement.style.pointerEvents = "none";
            document.getElementById('discard-count').innerText = discardsLeft;
            if(discardsLeft === 0) document.getElementById('btn-next-player').style.display = 'block';
        }
    }

    function nextPlayerSelection() {
        selectionPlayerIdx++;
        if(selectionPlayerIdx < config.players.length) {
            startSelectionPhase();
        } else {
            masterDeck = [];
            tempPlayerWords.forEach(pWords => { pWords.forEach(w => { if(w !== null) masterDeck.push(w); }); });
            masterDeck.sort(() => 0.5 - Math.random());
            playDeck = [...masterDeck];
            showScreen('screen-play');
            updateUI();
        }
    }

    function updateUI() {
        const scoreboard = document.getElementById('scoreboard-ui');
        scoreboard.innerHTML = Object.keys(scores).map(t => `<div class="team-score"><span style="color:var(--accent)">T${t}</span><br><b>${scores[t]}</b></div>`).join('');
        document.getElementById('current-player-name').innerText = config.players[currentPlayerIdx].name + ` (T${config.players[currentPlayerIdx].team})`;
        document.getElementById('deck-info').innerText = `Kalan: ${playDeck.length} / ${masterDeck.length}`;
        const banners = ["", "1. TUR: Serbest AnlatÄ±m", "2. TUR: Tek Kelime!", "3. TUR: Sessizce Anlat (MÄ°M)"];
        document.getElementById('round-instruction').innerText = banners[config.currentRound];
    }

    function startTurn() {
        if(playDeck.length === 0) return;
        let timeLeft = config.time;
        document.getElementById('timer-display').innerText = timeLeft;
        document.getElementById('ready-zone').classList.add('hidden');
        document.getElementById('play-zone').classList.remove('hidden');
        showWord();
        timerObj = setInterval(() => {
            timeLeft--;
            document.getElementById('timer-display').innerText = timeLeft;
            if(timeLeft <= 0) { playSound('timeup'); endTurn(); }
        }, 1000);
    }

    function showWord() {
        if(playDeck.length === 0) { endTurn(); return; }
        document.getElementById('current-word').innerText = playDeck[0];
    }

    function handleCorrect() {
        playSound('correct');
        scores[config.players[currentPlayerIdx].team]++;
        playDeck.shift();
        updateUI();
        if(playDeck.length === 0) { endTurn(); setTimeout(nextRound, 500); }
        else { showWord(); }
    }

    function handlePass() {
        playSound('pass');
        const word = playDeck.shift();
        playDeck.push(word);
        showWord();
    }

    function endTurn() {
        clearInterval(timerObj);
        document.getElementById('ready-zone').classList.remove('hidden');
        document.getElementById('play-zone').classList.add('hidden');
        currentPlayerIdx = (currentPlayerIdx + 1) % config.players.length;
        updateUI();
    }

    function nextRound() {
        if(config.currentRound < 3) {
            config.currentRound++;
            playDeck = [...masterDeck].sort(() => 0.5 - Math.random());
            updateUI();
            alert(`TUR BÄ°TTÄ°!\nYeni Kural: ${document.getElementById('round-instruction').innerText}`);
        } else {
            endGame();
        }
    }

    function endGame() {
        showScreen('screen-result');
        let results = Object.entries(scores).sort((a,b) => b[1] - a[1]);
        let txt = `ğŸ† ÅAMPÄ°YON: TAKIM ${results[0][0]}<br><br>`;
        results.forEach(([t, s]) => { txt += `TakÄ±m ${t}: ${s} Puan<br>`; });
        document.getElementById('winner-text').innerHTML = txt;
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
